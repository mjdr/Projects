mainModule.controller("profileController",function($scope, $http, $location){
	
	$scope.pages = [];
	
	$scope.loadPages = function(){
		
		$http.post("/page/list").
			success(function(res){
				
				if(res.status == 'ok')
					$scope.pages = res.body;
				else 
					alert("Error: " + res.body);
			
			}).
			error(function(res){
				alert("Server not respond.");
			});
		
		
		
	};
	
	$scope.logoutUser = function(){
		logout($http,$location);
	};
	
	$scope.$on('$routeChangeSuccess', function () {
		
		
		getCurrentUser($http,function(user){
			if(user == undefined) $location.path("/login");
			
			$scope.username = user.name;
			$scope.email = user.email;
			$scope.loadPages();
			
		});
		
	});
	
	
});